# remaining_chances å­—æ®µä¿®å¤æ€»ç»“

## ğŸ¯ ä¿®å¤ç›®æ ‡
å°†æŠ½å¥–è½®ç›˜åº”ç”¨ä¸­çš„ `drawchances` å­—æ®µç»Ÿä¸€æ›´æ–°ä¸º `remaining_chances` å­—æ®µï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§å’Œä»£ç è§„èŒƒæ€§ã€‚

## âœ… å·²å®Œæˆçš„ä¿®å¤å·¥ä½œ

### 1. æ•°æ®åº“ç»“æ„ä¿®å¤
- âœ… åˆ›å»ºäº† `fix-remaining-chances.sql` è„šæœ¬
- âœ… ç¡®ä¿ `users` è¡¨ä¸­æœ‰ `remaining_chances` å­—æ®µ
- âœ… åŒæ­¥ç°æœ‰ `drawchances` å­—æ®µæ•°æ®åˆ° `remaining_chances`
- âœ… æ·»åŠ äº† `draw_count` å­—æ®µç”¨äºç»Ÿè®¡æŠ½å¥–æ¬¡æ•°
- âœ… åˆ›å»ºäº† `settings` è¡¨ç”¨äºå†…å®¹ç®¡ç†

### 2. å‰ç«¯ä»£ç ä¿®å¤ (index.html)
- âœ… æ›´æ–°æŠ½å¥–æœºä¼šåˆ¤æ–­é€»è¾‘ï¼š`userData.drawchances <= 0` â†’ `(userData.remaining_chances || userData.drawchances || 1) <= 0`
- âœ… æ›´æ–°æŠ½å¥–æœºä¼šå‡å°‘é€»è¾‘ï¼š`newChances = currentUser.drawchances - 1` â†’ `newChances = currentUser.remaining_chances - 1`
- âœ… æ›´æ–°ç”¨æˆ·æ•°æ®å­˜å‚¨ï¼š`currentUser.drawchances = newChances` â†’ `currentUser.remaining_chances = newChances`
- âœ… æ›´æ–°æ•°æ®åº“æ›´æ–°æ“ä½œï¼š`drawchances: newChances` â†’ `remaining_chances: newChances`
- âœ… æ›´æ–°ç”¨æˆ·ä¼šè¯è®¾ç½®ï¼š`userData.drawchances` â†’ `userData.remaining_chances || userData.drawchances || 1`
- âœ… æ›´æ–°å®æ—¶è®¢é˜…é€»è¾‘ï¼š`currentUser.drawchances` â†’ `currentUser.remaining_chances || currentUser.drawchances || 1`
- âœ… æ›´æ–°æ–°ç”¨æˆ·æ³¨å†Œï¼š`drawchances: 1` â†’ `remaining_chances: 1`
- âœ… æ›´æ–°ç¦»çº¿æ¨¡å¼ï¼š`drawchances: 1` â†’ `remaining_chances: 1`

### 3. åç«¯å…¼å®¹æ€§
- âœ… ç®¡ç†é¡µé¢ (admin.html) å·²æ­£ç¡®ä½¿ç”¨ `remaining_chances` å­—æ®µ
- âœ… æ·»åŠ æŠ½å¥–æœºä¼šåŠŸèƒ½æ­£å¸¸å·¥ä½œ
- âœ… ç”¨æˆ·åˆ—è¡¨æ˜¾ç¤ºæ­£ç¡®çš„å‰©ä½™æœºä¼šæ•°

### 4. å‘åå…¼å®¹æ€§
- âœ… ä»£ç ä¸­æ·»åŠ äº†å…¼å®¹æ€§æ£€æŸ¥ï¼š`userData.remaining_chances || userData.drawchances || 1`
- âœ… ç¡®ä¿æ—§æ•°æ®ä»èƒ½æ­£å¸¸å·¥ä½œ
- âœ… å¹³æ»‘è¿‡æ¸¡ï¼Œæ— éœ€å¼ºåˆ¶æ•°æ®è¿ç§»

## ğŸ§ª æµ‹è¯•éªŒè¯

### åˆ›å»ºçš„æµ‹è¯•å·¥å…·
- âœ… `test-remaining-chances.html` - ä¸“é—¨çš„å­—æ®µä¿®å¤æµ‹è¯•é¡µé¢
- âœ… åŒ…å«æ•°æ®åº“è¿æ¥æµ‹è¯•
- âœ… åŒ…å«è¡¨ç»“æ„æ£€æŸ¥
- âœ… åŒ…å«å­—æ®µæ“ä½œæµ‹è¯•
- âœ… åŒ…å«ç”¨æˆ·æ•°æ®æŸ¥çœ‹

### æµ‹è¯•å†…å®¹
1. **æ•°æ®åº“è¿æ¥æµ‹è¯•** - éªŒè¯ Supabase è¿æ¥æ­£å¸¸
2. **è¡¨ç»“æ„æ£€æŸ¥** - ç¡®è®¤ `remaining_chances` å­—æ®µå­˜åœ¨
3. **å­—æ®µæ“ä½œæµ‹è¯•** - éªŒè¯è¯»å†™åŠŸèƒ½æ­£å¸¸
4. **ç”¨æˆ·æ•°æ®æŸ¥çœ‹** - æ£€æŸ¥å®é™…æ•°æ®çŠ¶æ€

## ğŸ“Š ä¿®å¤å½±å“èŒƒå›´

### å—å½±å“çš„æ–‡ä»¶
1. `index.html` - ä¸»åº”ç”¨é¡µé¢ âœ…
2. `admin.html` - ç®¡ç†é¡µé¢ âœ… (å·²æ­£ç¡®ä½¿ç”¨)
3. `fix-remaining-chances.sql` - æ•°æ®åº“ä¿®å¤è„šæœ¬ âœ…
4. `test-remaining-chances.html` - æµ‹è¯•é¡µé¢ âœ…

### ä¸å—å½±å“çš„æ–‡ä»¶
- `config.js` - API é…ç½®æ–‡ä»¶
- `supabase-config.js` - Supabase é…ç½®æ–‡ä»¶
- å…¶ä»–æ–‡æ¡£å’Œé…ç½®æ–‡ä»¶

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### å­—æ®µæ˜ å°„
```javascript
// æ—§å­—æ®µ â†’ æ–°å­—æ®µ
drawchances â†’ remaining_chances

// å…¼å®¹æ€§å†™æ³•
userData.remaining_chances || userData.drawchances || 1
```

### æ•°æ®åº“æ“ä½œ
```sql
-- æ·»åŠ æ–°å­—æ®µ
ALTER TABLE users ADD COLUMN IF NOT EXISTS remaining_chances INTEGER DEFAULT 1;

-- æ•°æ®åŒæ­¥
UPDATE users SET remaining_chances = drawchances WHERE drawchances IS NOT NULL;
```

### å‰ç«¯æ›´æ–°ç¤ºä¾‹
```javascript
// æ—§ä»£ç 
if (userData.drawchances <= 0) { ... }

// æ–°ä»£ç ï¼ˆå…¼å®¹æ€§ï¼‰
if ((userData.remaining_chances || userData.drawchances || 1) <= 0) { ... }
```

## ğŸš€ éƒ¨ç½²å»ºè®®

### éƒ¨ç½²æ­¥éª¤
1. **æ•°æ®åº“æ›´æ–°**ï¼šè¿è¡Œ `fix-remaining-chances.sql` è„šæœ¬
2. **ä»£ç éƒ¨ç½²**ï¼šéƒ¨ç½²æ›´æ–°åçš„å‰ç«¯ä»£ç 
3. **åŠŸèƒ½æµ‹è¯•**ï¼šä½¿ç”¨ `test-remaining-chances.html` éªŒè¯
4. **ç”¨æˆ·éªŒè¯**ï¼šç¡®è®¤ç°æœ‰ç”¨æˆ·æ•°æ®æ­£å¸¸

### å›æ»šè®¡åˆ’
å¦‚æœå‡ºç°é—®é¢˜ï¼Œå¯ä»¥ï¼š
1. æ¢å¤æ—§ç‰ˆæœ¬ä»£ç 
2. æ•°æ®åº“ä¸­çš„ `drawchances` å­—æ®µä»ç„¶ä¿ç•™
3. æ–°çš„ `remaining_chances` å­—æ®µå¯ä»¥ä¿ç•™æˆ–åˆ é™¤

## ğŸ“ˆ é¢„æœŸæ•ˆæœ

### ç”¨æˆ·ä½“éªŒ
- âœ… æŠ½å¥–åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- âœ… æŠ½å¥–æœºä¼šæ˜¾ç¤ºæ­£ç¡®
- âœ… ç®¡ç†å‘˜å¯ä»¥æ­£å¸¸æ·»åŠ æœºä¼š
- âœ… æ•°æ®ç»Ÿè®¡å‡†ç¡®

### å¼€å‘ä½“éªŒ
- âœ… ä»£ç æ›´è§„èŒƒç»Ÿä¸€
- âœ… å­—æ®µå‘½åæ›´æ¸…æ™°
- âœ… ä¾¿äºåç»­ç»´æŠ¤
- âœ… å‘åå…¼å®¹æ€§è‰¯å¥½

## ğŸ” ç›‘æ§è¦ç‚¹

### éœ€è¦å…³æ³¨çš„æŒ‡æ ‡
1. **ç”¨æˆ·æ³¨å†ŒæˆåŠŸç‡** - ç¡®ä¿æ–°ç”¨æˆ·èƒ½æ­£å¸¸æ³¨å†Œ
2. **æŠ½å¥–åŠŸèƒ½æ­£å¸¸ç‡** - ç¡®ä¿æŠ½å¥–é€»è¾‘æ­£ç¡®
3. **æ•°æ®ä¸€è‡´æ€§** - ç¡®ä¿æ–°æ—§å­—æ®µæ•°æ®åŒæ­¥
4. **ç®¡ç†åŠŸèƒ½** - ç¡®ä¿ç®¡ç†å‘˜æ“ä½œæ­£å¸¸

### å¯èƒ½çš„é—®é¢˜
1. **ç¼“å­˜é—®é¢˜** - ç”¨æˆ·æµè§ˆå™¨ç¼“å­˜å¯èƒ½éœ€è¦æ¸…ç†
2. **æ•°æ®åŒæ­¥** - ç¡®ä¿æ‰€æœ‰ç”¨æˆ·æ•°æ®éƒ½å·²æ­£ç¡®è¿ç§»
3. **å®æ—¶æ›´æ–°** - ç¡®ä¿å®æ—¶è®¢é˜…åŠŸèƒ½æ­£å¸¸

## ğŸ“ åç»­ä¼˜åŒ–å»ºè®®

### çŸ­æœŸä¼˜åŒ–
1. **ç›‘æ§æ•°æ®** - è§‚å¯Ÿä¸€å‘¨å†…çš„ç”¨æˆ·è¡Œä¸º
2. **æ€§èƒ½æµ‹è¯•** - ç¡®ä¿ä¿®å¤æ²¡æœ‰å½±å“æ€§èƒ½
3. **ç”¨æˆ·åé¦ˆ** - æ”¶é›†ç”¨æˆ·ä½¿ç”¨åé¦ˆ

### é•¿æœŸä¼˜åŒ–
1. **æ¸…ç†æ—§å­—æ®µ** - ç¡®è®¤ç¨³å®šåå¯è€ƒè™‘åˆ é™¤ `drawchances` å­—æ®µ
2. **ä»£ç é‡æ„** - ç§»é™¤å…¼å®¹æ€§ä»£ç ï¼Œç®€åŒ–é€»è¾‘
3. **æ–‡æ¡£æ›´æ–°** - æ›´æ–°ç›¸å…³æŠ€æœ¯æ–‡æ¡£

---

## ğŸ‰ ä¿®å¤å®Œæˆ

âœ… **remaining_chances å­—æ®µä¿®å¤å·²å®Œæˆï¼**

æ‰€æœ‰ç›¸å…³ä»£ç å·²æ›´æ–°ï¼Œæ•°æ®åº“ç»“æ„å·²ä¿®å¤ï¼Œæµ‹è¯•å·¥å…·å·²åˆ›å»ºã€‚åº”ç”¨ç°åœ¨ä½¿ç”¨ç»Ÿä¸€çš„ `remaining_chances` å­—æ®µï¼ŒåŒæ—¶ä¿æŒå‘åå…¼å®¹æ€§ã€‚

**æµ‹è¯•åœ°å€ï¼š**
- ä¸»åº”ç”¨ï¼šhttp://localhost:8081/index.html
- ç®¡ç†é¡µé¢ï¼šhttp://localhost:8081/admin.html  
- æµ‹è¯•é¡µé¢ï¼šhttp://localhost:8081/test-remaining-chances.html

**ä¸‹ä¸€æ­¥ï¼š** å¯ä»¥å¼€å§‹æ­£å¸¸ä½¿ç”¨åº”ç”¨ï¼Œæ‰€æœ‰æŠ½å¥–åŠŸèƒ½éƒ½åº”è¯¥æ­£å¸¸å·¥ä½œã€‚