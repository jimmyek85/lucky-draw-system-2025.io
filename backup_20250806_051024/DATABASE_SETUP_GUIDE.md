# 数据库设置指南

## 概述
本指南将帮助您在 Supabase 中设置增强版抽奖轮盘系统所需的数据库结构。

## 前提条件
- 已有 Supabase 项目
- 具有数据库管理权限

## 设置步骤

### 1. 执行 SQL 脚本
在 Supabase 控制台的 SQL 编辑器中执行 `enhanced-database-setup.sql` 文件中的所有 SQL 语句。

### 2. 验证表结构
确保以下表已成功创建：

#### 更新的表
- `users` - 用户表（已添加新字段）
  - `won_prizes` - 获得的奖品记录
  - `extra_chances` - 额外抽奖机会
  - `total_draws` - 总抽奖次数
  - `last_draw_date` - 最后抽奖日期

#### 新增的表
- `announcements` - 公告栏
- `product_knowledge` - 产品知识库
- `file_uploads` - 文件上传记录
- `draw_history` - 抽奖历史
- `system_stats` - 系统统计

### 3. 配置行级安全策略 (RLS)
确保所有表都启用了 RLS，并且策略配置正确。

### 4. 测试连接
使用管理面板测试数据库连接和功能。

## 新功能说明

### 1. 每日参与者统计
- 系统会自动统计每日参与抽奖的用户数量
- 在管理面板的仪表板中显示

### 2. 用户管理增强
- 显示用户获得的所有奖品
- 支持通过姓名或电话号码搜索用户
- 管理员可手动为用户添加抽奖机会

### 3. 公告栏系统
- 管理员可发布带图片的公告
- 用户登录时会自动弹出最新公告
- 支持公告的启用/禁用状态

### 4. 产品知识库
- 支持上传产品图片和文档
- 为 AI 推荐功能提供精准的产品信息
- 支持产品分类管理

### 5. 实时更新
- 用户抽奖机会的实时同步
- 管理员操作后前端立即更新

## 故障排除

### 常见问题
1. **表创建失败**
   - 检查 SQL 语法
   - 确保有足够的权限

2. **RLS 策略问题**
   - 验证策略配置
   - 检查用户权限设置

3. **连接问题**
   - 验证 Supabase URL 和 API 密钥
   - 检查网络连接

### 联系支持
如遇到问题，请检查：
- Supabase 控制台的错误日志
- 浏览器开发者工具的控制台
- 网络连接状态

## 安全注意事项
- 定期备份数据库
- 监控异常访问
- 保护 API 密钥安全
- 定期更新安全策略