<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é…ç½®æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #1a1a1a;
            color: white;
        }
        .test-section {
            background: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
        }
        .error {
            border-left-color: #f44336;
        }
        .warning {
            border-left-color: #ff9800;
        }
        .result {
            background: #333;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #45a049;
        }
    </style>
</head>
<body>
    <h1>ğŸ” æŠ½å¥–é…ç½®æµ‹è¯•é¡µé¢</h1>
    
    <div class="test-section">
        <h2>1. é…ç½®æ–‡ä»¶æ£€æŸ¥</h2>
        <button onclick="testConfigFile()">æµ‹è¯• config.js</button>
        <div id="config-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>2. æ–°ç”¨æˆ·æ³¨å†Œæµ‹è¯•</h2>
        <button onclick="testNewUserRegistration()">æ¨¡æ‹Ÿæ–°ç”¨æˆ·æ³¨å†Œ</button>
        <div id="registration-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>3. æŠ½å¥–é…ç½®è·å–æµ‹è¯•</h2>
        <button onclick="testLotteryConfig()">æµ‹è¯•æŠ½å¥–é…ç½®è·å–</button>
        <div id="lottery-config-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>4. æ•°æ®åº“è¿æ¥æµ‹è¯•</h2>
        <button onclick="testDatabaseConnection()">æµ‹è¯•æ•°æ®åº“è¿æ¥</button>
        <div id="db-result" class="result"></div>
    </div>

    <script src="config.js"></script>
    <script>
        // æµ‹è¯•é…ç½®æ–‡ä»¶
        function testConfigFile() {
            const result = document.getElementById('config-result');
            try {
                if (typeof LOTTERY_CONFIG !== 'undefined') {
                    result.innerHTML = `
                        <strong>âœ… config.js åŠ è½½æˆåŠŸ</strong><br>
                        INITIAL_CHANCES: ${LOTTERY_CONFIG.INITIAL_CHANCES}<br>
                        SPIN_AGAIN_BONUS: ${LOTTERY_CONFIG.SPIN_AGAIN_BONUS}<br>
                        MAX_ACCUMULATED_CHANCES: ${LOTTERY_CONFIG.MAX_ACCUMULATED_CHANCES}<br>
                        DAILY_FREE_CHANCES: ${LOTTERY_CONFIG.DAILY_FREE_CHANCES}<br>
                        <br>
                        ${LOTTERY_CONFIG.INITIAL_CHANCES === 1 ? 
                          '<span style="color: #4CAF50;">âœ… æ–°ç”¨æˆ·åˆå§‹æœºä¼šæ­£ç¡®è®¾ç½®ä¸º 1</span>' : 
                          '<span style="color: #f44336;">âŒ æ–°ç”¨æˆ·åˆå§‹æœºä¼šåº”è¯¥ä¸º 1ï¼Œå½“å‰ä¸º ' + LOTTERY_CONFIG.INITIAL_CHANCES + '</span>'}
                    `;
                } else {
                    result.innerHTML = '<span style="color: #f44336;">âŒ LOTTERY_CONFIG æœªå®šä¹‰</span>';
                }
            } catch (error) {
                result.innerHTML = `<span style="color: #f44336;">âŒ é”™è¯¯: ${error.message}</span>`;
            }
        }

        // æµ‹è¯•æ–°ç”¨æˆ·æ³¨å†Œé€»è¾‘
        function testNewUserRegistration() {
            const result = document.getElementById('registration-result');
            try {
                // æ¨¡æ‹Ÿæ–°ç”¨æˆ·æ•°æ®
                const mockUser = {
                    name: 'æµ‹è¯•ç”¨æˆ·',
                    phone: '13800138000',
                    isNewUser: true
                };

                // æ¨¡æ‹Ÿè·å–æŠ½å¥–é…ç½®
                const lotteryConfig = LOTTERY_CONFIG || {
                    INITIAL_CHANCES: 3,
                    SPIN_AGAIN_BONUS: 1,
                    MAX_ACCUMULATED_CHANCES: 10
                };

                const initialChances = lotteryConfig.INITIAL_CHANCES || 3;
                
                result.innerHTML = `
                    <strong>ğŸ“ æ–°ç”¨æˆ·æ³¨å†Œæ¨¡æ‹Ÿ</strong><br>
                    ç”¨æˆ·å: ${mockUser.name}<br>
                    æ‰‹æœºå·: ${mockUser.phone}<br>
                    åˆå§‹æŠ½å¥–æœºä¼š: ${initialChances}<br>
                    <br>
                    ${initialChances === 1 ? 
                      '<span style="color: #4CAF50;">âœ… æ–°ç”¨æˆ·åªè·å¾— 1 æ¬¡å…è´¹æŠ½å¥–æœºä¼š</span>' : 
                      '<span style="color: #f44336;">âŒ æ–°ç”¨æˆ·è·å¾—äº† ' + initialChances + ' æ¬¡æœºä¼šï¼Œåº”è¯¥åªæœ‰ 1 æ¬¡</span>'}
                `;
            } catch (error) {
                result.innerHTML = `<span style="color: #f44336;">âŒ é”™è¯¯: ${error.message}</span>`;
            }
        }

        // æµ‹è¯•æŠ½å¥–é…ç½®è·å–
        function testLotteryConfig() {
            const result = document.getElementById('lottery-config-result');
            
            // æ¨¡æ‹Ÿ getLotteryConfig å‡½æ•°çš„é€»è¾‘
            function mockGetLotteryConfig() {
                try {
                    // æ¨¡æ‹Ÿç¦»çº¿æ¨¡å¼
                    const offlineConfig = {
                        INITIAL_CHANCES: LOTTERY_CONFIG?.INITIAL_CHANCES || 1,
                        SPIN_AGAIN_BONUS: LOTTERY_CONFIG?.SPIN_AGAIN_BONUS || 1,
                        MAX_ACCUMULATED_CHANCES: LOTTERY_CONFIG?.MAX_ACCUMULATED_CHANCES || 10,
                        DAILY_FREE_CHANCES: LOTTERY_CONFIG?.DAILY_FREE_CHANCES || 1,
                        ENABLE_DAILY_FREE: LOTTERY_CONFIG?.ENABLE_DAILY_FREE || false,
                        ALLOW_ADMIN_ADD_CHANCES: LOTTERY_CONFIG?.ALLOW_ADMIN_ADD_CHANCES || true
                    };
                    return offlineConfig;
                } catch (error) {
                    // å¼‚å¸¸æƒ…å†µä¸‹çš„é»˜è®¤é…ç½®
                    return {
                        INITIAL_CHANCES: 1,
                        SPIN_AGAIN_BONUS: 1,
                        MAX_ACCUMULATED_CHANCES: 10,
                        DAILY_FREE_CHANCES: 1,
                        ENABLE_DAILY_FREE: false,
                        ALLOW_ADMIN_ADD_CHANCES: true
                    };
                }
            }

            const config = mockGetLotteryConfig();
            
            result.innerHTML = `
                <strong>âš™ï¸ æŠ½å¥–é…ç½®è·å–æµ‹è¯•</strong><br>
                INITIAL_CHANCES: ${config.INITIAL_CHANCES}<br>
                SPIN_AGAIN_BONUS: ${config.SPIN_AGAIN_BONUS}<br>
                MAX_ACCUMULATED_CHANCES: ${config.MAX_ACCUMULATED_CHANCES}<br>
                DAILY_FREE_CHANCES: ${config.DAILY_FREE_CHANCES}<br>
                <br>
                ${config.INITIAL_CHANCES === 1 ? 
                  '<span style="color: #4CAF50;">âœ… é…ç½®æ­£ç¡®ï¼šæ–°ç”¨æˆ·åˆå§‹æœºä¼šä¸º 1</span>' : 
                  '<span style="color: #f44336;">âŒ é…ç½®é”™è¯¯ï¼šæ–°ç”¨æˆ·åˆå§‹æœºä¼šä¸º ' + config.INITIAL_CHANCES + 'ï¼Œåº”è¯¥ä¸º 1</span>'}
            `;
        }

        // æµ‹è¯•æ•°æ®åº“è¿æ¥
        function testDatabaseConnection() {
            const result = document.getElementById('db-result');
            
            if (typeof window.SUPABASE_CONFIG !== 'undefined') {
                const config = window.SUPABASE_CONFIG;
                const isConfigured = config.SUPABASE_URL !== 'https://your-project-id.supabase.co' && 
                                   config.SUPABASE_ANON_KEY !== 'your-supabase-anon-key-here';
                
                result.innerHTML = `
                    <strong>ğŸ”— æ•°æ®åº“é…ç½®æ£€æŸ¥</strong><br>
                    Supabase URL: ${config.SUPABASE_URL}<br>
                    API Key: ${config.SUPABASE_ANON_KEY ? 'å·²é…ç½®' : 'æœªé…ç½®'}<br>
                    <br>
                    ${isConfigured ? 
                      '<span style="color: #4CAF50;">âœ… Supabase é…ç½®å·²è®¾ç½®</span>' : 
                      '<span style="color: #f44336;">âŒ Supabase é…ç½®æœªæ­£ç¡®è®¾ç½®</span>'}
                    <br><br>
                    <em>æ³¨æ„ï¼šå®é™…è¿æ¥æµ‹è¯•éœ€è¦åœ¨æœ‰ç½‘ç»œçš„ç¯å¢ƒä¸­è¿›è¡Œ</em>
                `;
            } else {
                result.innerHTML = '<span style="color: #f44336;">âŒ SUPABASE_CONFIG æœªæ‰¾åˆ°</span>';
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œæ‰€æœ‰æµ‹è¯•
        window.onload = function() {
            setTimeout(() => {
                testConfigFile();
                testNewUserRegistration();
                testLotteryConfig();
                testDatabaseConnection();
            }, 500);
        };
    </script>
</body>
</html>